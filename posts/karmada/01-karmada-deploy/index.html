<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>K8s 多集群(一)---Karmada 初体验 -</title><meta name=Description content="k8s 多集群项目 Karmada 初体验"><meta property="og:title" content="K8s 多集群(一)---Karmada 初体验"><meta property="og:description" content="k8s 多集群项目 Karmada 初体验"><meta property="og:type" content="article"><meta property="og:url" content="https://www.lixueduan.com/posts/karmada/01-karmada-deploy/"><meta property="og:image" content="https://www.lixueduan.com/img/jinx.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-08T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-08T00:00:00+00:00"><meta property="og:site_name" content="意琦行的个人博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.lixueduan.com/img/jinx.png"><meta name=twitter:title content="K8s 多集群(一)---Karmada 初体验"><meta name=twitter:description content="k8s 多集群项目 Karmada 初体验"><meta name=application-name content="指月小筑"><meta name=apple-mobile-web-app-title content="指月小筑"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/><link rel=prev href=https://www.lixueduan.com/posts/docker/11-use-ssh-private-key-in-docker-build/><link rel=stylesheet href=/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"K8s 多集群(一)---Karmada 初体验","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.lixueduan.com\/posts\/karmada\/01-karmada-deploy\/"},"image":["https:\/\/www.lixueduan.com\/img\/jinx.png"],"genre":"posts","keywords":"Karmada","wordcount":3003,"url":"https:\/\/www.lixueduan.com\/posts\/karmada\/01-karmada-deploy\/","datePublished":"2023-04-08T00:00:00+00:00","dateModified":"2023-04-08T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"意琦行"},"description":"k8s 多集群项目 Karmada 初体验"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>指月小筑</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=指月小筑>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/ title=关于>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>指月小筑</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title=指月小筑>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title=关于>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">K8s 多集群(一)---Karmada 初体验</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/lixd title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>意琦行</a></span>&nbsp;<span class=post-category>included in <a href=/categories/karmada/><i class="far fa-folder fa-fw" aria-hidden=true></i>Karmada</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-04-08>2023-04-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3003 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-环境准备>1. 环境准备</a></li><li><a href=#2-karmada-部署>2. Karmada 部署</a><ul><li><a href=#安装-kubectl-karmada-插件>安装 kubectl-karmada 插件</a></li><li><a href=#初始化karmada>初始化karmada</a></li></ul></li><li><a href=#3-集群管理>3. 集群管理</a><ul><li><a href=#push-模式>Push 模式</a></li><li><a href=#pull-模式>Pull 模式</a></li><li><a href=#小结>小结</a></li></ul></li><li><a href=#4-应用分发>4. 应用分发</a><ul><li><a href=#创建-propagationpolicy>创建 PropagationPolicy</a></li><li><a href=#创建-deploy>创建 deploy</a></li><li><a href=#创建-overridepolicy>创建 OverridePolicy</a></li></ul></li><li><a href=#5-小结>5. 小结</a></li></ul></nav></div></div><div class=content id=content><p>本文主要记录了 Kubernetes 多集群项目 Karmada 部署及简单使用。</p><p>一句话简介：Karmada 是一个 Kubernetes 多集群领域的开源项目，旨在让用户像使用单集群一样使用多集群。</p><blockquote><p>github repo：<a href=https://github.com/karmada-io/karmada target=_blank rel="noopener noreffer">https://github.com/karmada-io/karmada</a></p></blockquote><h2 id=1-环境准备>1. 环境准备</h2><p>Karmada 本身也是运行在 k8s 上的，因此我们需要先准备一个 k8s 环境，同时为了体验多集群效果，最好能多建几个集群。</p><blockquote><p>推荐使用 KubeClipper 来创建 k8s 集群，一条命令搞定：<a href=https://www.lixueduan.com/posts/kubernetes/11-install-by-kubeclipper/ target=_blank rel="noopener noreffer">Kubernetes教程(十一)&mdash;使用 KubeClipper 通过一条命令快速创建 k8s 集群</a></p></blockquote><p>本文将使用 3 台 2c4g 机器部署 3 个单 master 集群，其中 1 个用于运行 karmada，另外两个作为业务集群使用。</p><h2 id=2-karmada-部署>2. Karmada 部署</h2><h3 id=安装-kubectl-karmada-插件>安装 kubectl-karmada 插件</h3><p>karmada 提供了 kubectl 插件，通过该插件可以很轻松的安装 Karmada，因此我们先安装该插件。</p><p>可以使用以下命令一键安装</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>curl -s https://raw.githubusercontent.com/karmada-io/karmada/master/hack/install-cli.sh <span class=p>|</span> sudo bash -s kubectl-karmada
</span></span></code></pre></div><p>或者手动下载</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>wget https://github.com/karmada-io/karmada/releases/download/v1.5.0/kubectl-karmada-linux-amd64.tgz
</span></span><span class=line><span class=cl>tar -zxvf kubectl-karmada-linux-amd64.tgz
</span></span><span class=line><span class=cl>cp kubectl-karmada /usr/local/bin
</span></span><span class=line><span class=cl>kubectl-karmada version
</span></span></code></pre></div><h3 id=初始化karmada>初始化karmada</h3><p>正常情况下执行以下命令即可完成 Karmada 初始化</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl karmada init
</span></span></code></pre></div><blockquote><p>不过该命令默认会去 github 下载 crd 压缩包，同时默认会去 k8s.io 拉镜像。</p></blockquote><p>因此在国内使用时，由于网络问题导致还需要指定一些参数才行：</p><p>先手动下载 crd，实际上里面就是一些 crd 的 yaml 文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>wget https://github.com/karmada-io/karmada/releases/download/v1.5.0/crds.tar.gz
</span></span></code></pre></div><p>然后 init 时指定 crd 地址以及镜像仓库</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>kubectl karmada init <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--kube-image-registry registry.cn-hangzhou.aliyuncs.com/google_containers <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--crds crds.tar.gz
</span></span></code></pre></div><p>安装完成后输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=c1>------------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=err>█████</span><span class=w>   </span><span class=err>████</span><span class=w>   </span><span class=err>█████████</span><span class=w>   </span><span class=err>███████████</span><span class=w>   </span><span class=err>██████</span><span class=w>   </span><span class=err>██████</span><span class=w>   </span><span class=err>█████████</span><span class=w>   </span><span class=err>██████████</span><span class=w>     </span><span class=err>█████████</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>░░███</span><span class=w>   </span><span class=err>███░</span><span class=w>   </span><span class=err>███░░░░░███</span><span class=w> </span><span class=err>░░███░░░░░███</span><span class=w> </span><span class=err>░░██████</span><span class=w> </span><span class=err>██████</span><span class=w>   </span><span class=err>███░░░░░███</span><span class=w> </span><span class=err>░░███░░░░███</span><span class=w>   </span><span class=err>███░░░░░███</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>░███</span><span class=w>  </span><span class=err>███</span><span class=w>    </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███░█████░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>   </span><span class=err>░░███</span><span class=w> </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>░███████</span><span class=w>     </span><span class=err>░███████████</span><span class=w>  </span><span class=err>░██████████</span><span class=w>   </span><span class=err>░███░░███</span><span class=w> </span><span class=err>░███</span><span class=w>  </span><span class=err>░███████████</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w> </span><span class=err>░███████████</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>░███░░███</span><span class=w>    </span><span class=err>░███░░░░░███</span><span class=w>  </span><span class=err>░███░░░░░███</span><span class=w>  </span><span class=err>░███</span><span class=w> </span><span class=err>░░░</span><span class=w>  </span><span class=err>░███</span><span class=w>  </span><span class=err>░███░░░░░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w> </span><span class=err>░███░░░░░███</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>░███</span><span class=w> </span><span class=err>░░███</span><span class=w>   </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>      </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>███</span><span class=w>  </span><span class=err>░███</span><span class=w>    </span><span class=err>░███</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=err>█████</span><span class=w> </span><span class=err>░░████</span><span class=w> </span><span class=err>█████</span><span class=w>   </span><span class=err>█████</span><span class=w> </span><span class=err>█████</span><span class=w>   </span><span class=err>█████</span><span class=w> </span><span class=err>█████</span><span class=w>     </span><span class=err>█████</span><span class=w> </span><span class=err>█████</span><span class=w>   </span><span class=err>█████</span><span class=w> </span><span class=err>██████████</span><span class=w>   </span><span class=err>█████</span><span class=w>   </span><span class=err>█████</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>░░░░░</span><span class=w>   </span><span class=err>░░░░</span><span class=w> </span><span class=err>░░░░░</span><span class=w>   </span><span class=err>░░░░░</span><span class=w> </span><span class=err>░░░░░</span><span class=w>   </span><span class=err>░░░░░</span><span class=w> </span><span class=err>░░░░░</span><span class=w>     </span><span class=err>░░░░░</span><span class=w> </span><span class=err>░░░░░</span><span class=w>   </span><span class=err>░░░░░</span><span class=w> </span><span class=err>░░░░░░░░░░</span><span class=w>   </span><span class=err>░░░░░</span><span class=w>   </span><span class=err>░░░░░</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>------------------------------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Karmada</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>installed</span><span class=w> </span><span class=n>successfully</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Register</span><span class=w> </span><span class=n>Kubernetes</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>Karmada</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>plane</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Register</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=s1>&#39;Push&#39;</span><span class=w> </span><span class=k>mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Step</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=n>Use</span><span class=w> </span><span class=s2>&#34;kubectl karmada join&#34;</span><span class=w> </span><span class=n>command</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>register</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>Karmada</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>plane</span><span class=p>.</span><span class=w> </span><span class=c1>--cluster-kubeconfig is kubeconfig of the member cluster.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=k>In</span><span class=w> </span><span class=n>karmada</span><span class=p>)</span><span class=o>~#</span><span class=w> </span><span class=n>MEMBER_CLUSTER_NAME</span><span class=o>=</span><span class=err>$</span><span class=p>(</span><span class=n>cat</span><span class=w> </span><span class=o>~/</span><span class=p>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>grep</span><span class=w> </span><span class=k>current</span><span class=o>-</span><span class=n>context</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>sed</span><span class=w> </span><span class=s1>&#39;s/: /\n/g&#39;</span><span class=o>|</span><span class=w> </span><span class=n>sed</span><span class=w> </span><span class=s1>&#39;1d&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>In</span><span class=w> </span><span class=n>karmada</span><span class=p>)</span><span class=o>~#</span><span class=w> </span><span class=n>kubectl</span><span class=w> </span><span class=n>karmada</span><span class=w> </span><span class=c1>--kubeconfig /etc/karmada/karmada-apiserver.config  join ${MEMBER_CLUSTER_NAME} --cluster-kubeconfig=$HOME/.kube/config
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Step</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>Show</span><span class=w> </span><span class=n>members</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>karmada</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>In</span><span class=w> </span><span class=n>karmada</span><span class=p>)</span><span class=o>~#</span><span class=w> </span><span class=n>kubectl</span><span class=w> </span><span class=c1>--kubeconfig /etc/karmada/karmada-apiserver.config get clusters
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Register</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=s1>&#39;Pull&#39;</span><span class=w> </span><span class=k>mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Step</span><span class=w> </span><span class=mi>1</span><span class=p>:</span><span class=w> </span><span class=n>Use</span><span class=w> </span><span class=s2>&#34;kubectl karmada register&#34;</span><span class=w> </span><span class=n>command</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>register</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>Karmada</span><span class=w> </span><span class=n>control</span><span class=w> </span><span class=n>plane</span><span class=p>.</span><span class=w> </span><span class=s2>&#34;--cluster-name&#34;</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>cluster</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=k>current</span><span class=o>-</span><span class=n>context</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>default</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>In</span><span class=w> </span><span class=n>member</span><span class=w> </span><span class=k>cluster</span><span class=p>)</span><span class=o>~#</span><span class=w> </span><span class=n>kubectl</span><span class=w> </span><span class=n>karmada</span><span class=w> </span><span class=n>register</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>58</span><span class=p>:</span><span class=mi>32443</span><span class=w> </span><span class=c1>--token jcbljd.tfotd1ylodf7jtm6 --discovery-token-ca-cert-hash sha256:3bc5b22efbef8470f010f65b68388266e2b8f3ab62a0151900761cd12760d34f
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Step</span><span class=w> </span><span class=mi>2</span><span class=p>:</span><span class=w> </span><span class=k>Show</span><span class=w> </span><span class=n>members</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>karmada</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>In</span><span class=w> </span><span class=n>karmada</span><span class=p>)</span><span class=o>~#</span><span class=w> </span><span class=n>kubectl</span><span class=w> </span><span class=c1>--kubeconfig /etc/karmada/karmada-apiserver.config get clusters
</span></span></span></code></pre></div><h2 id=3-集群管理>3. 集群管理</h2><p>Karmada 初始化完成后就可以将业务集群添加到 Karmada 中进行管理了。</p><p>注册方式分为 Push 模式和 Pull 模式，二者的注册方式不相同。</p><ul><li>Push 模式下，karmada 控制面会直接访问 member 集群的 kube-apiserver 以获取集群状态和部署资源</li><li>Pull 模式下，会在 member 集群部署 karmada-agent ，包含以下作用<ul><li>注册集群到 karmada</li><li>维护集群状态并报告给 karmada</li><li>Watch karmada 集群里对应 namespace 下的资源对象，并将其部署到 member 集群里。</li></ul></li></ul><h3 id=push-模式>Push 模式</h3><p>Push 模式完整命令如下:</p><blockquote><p>需要注意的是 push 模式下 join 命令是在 karmada 集群中执行</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1># 语法</span>
</span></span><span class=line><span class=cl><span class=c1># kubectl karmada join &lt;member-cluster-name&gt; --kubeconfig=&lt;karmada kubeconfig&gt; --cluster-kubeconfig=&lt;member1 kubeconfig&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># join</span>
</span></span><span class=line><span class=cl>kubectl karmada --kubeconfig /etc/karmada/karmada-apiserver.config join cluster1 --cluster-kubeconfig<span class=o>=</span><span class=nv>$HOME</span>/.kube/config
</span></span></code></pre></div><p>各个参数含义应该一眼就能看出来：</p><ul><li><code>--kubeconfig /etc/karmada/karmada-apiserver.config</code>指定 Karmada kubeconfig，表示操作的是 karmada 的 apiserver，<ul><li>实际上 Karmada apiserver 也是基于 kube-apiserver 源码修改的，因此相关操作也基本一致。</li></ul></li><li><code>--cluster-kubeconfig=$HOME/.kube/config</code> 则是指定待注册到 karmada 的 member 集群的 kubeconfig。</li></ul><p>添加好后可以使用 kubectl 命令进行查看</p><blockquote><p>member 集群在 karmada 中使用 clusters 这个 CR 对象进行存储</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@karmada ~<span class=o>]</span><span class=c1>#  kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get clusters</span>
</span></span><span class=line><span class=cl>NAME     VERSION   MODE   READY   AGE
</span></span><span class=line><span class=cl>Cluster1 v1.23.6   Push   True   1m24s
</span></span></code></pre></div><p>可以看到 cluster1 已经成功添加进来了。</p><h3 id=pull-模式>Pull 模式</h3><p>Pull 模式完整命令如下：</p><blockquote><p>需要注意的是 pull 模式下的 register 命令需要到 member 集群中执行</p></blockquote><p>pull 模式下的注册命令格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl karmada register &lt;karmada-apiserver&gt; --token &lt;token&gt; --discovery-token-ca-cert-hash &lt;hash&gt;
</span></span></code></pre></div><p>类似与 kubeadm join 命令，需要提供 token 以及 ca证书的 hash 值作为校验。</p><p>大家仔细观察的话，可以发现在执行 karmada init 之后输出的日志里实际上是有提供该命令的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl karmada register 10.0.0.58:32443 --token jcbljd.tfotd1ylodf7jtm6 --discovery-token-ca-cert-hash sha256:3bc5b22efbef8470f010f65b68388266e2b8f3ab62a0151900761cd12760d34f
</span></span></code></pre></div><p>当然，我们也可以使用以下命令重新生成 token（有效期 24h）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>kubectl karmada token create --print-register-command --kubeconfig /etc/karmada/karmada-apiserver.config
</span></span></code></pre></div><p>输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@lixd-tmp-1 ~<span class=o>]</span><span class=c1># kubectl karmada token create --print-register-command --kubeconfig /etc/karmada/karmada-apiserver.config</span>
</span></span><span class=line><span class=cl>kubectl karmada register 10.0.0.58:32443 --token 7pn49b.d9xhhpn9x8haqraq --discovery-token-ca-cert-hash sha256:3bc5b22efbef8470f010f65b68388266e2b8f3ab62a0151900761cd12760d34f
</span></span></code></pre></div><p>在 member 集群执行该命令进行注册：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>kubectl karmada register 10.0.0.58:32443 --token jcbljd.tfotd1ylodf7jtm6 --discovery-token-ca-cert-hash sha256:3bc5b22efbef8470f010f65b68388266e2b8f3ab62a0151900761cd12760d34f
</span></span></code></pre></div><p>注册的时候会在当前集群启动一个 karmada-agent pod，用于和 karmada apiserver 交互。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@lixd-tmp-2 ~<span class=o>]</span><span class=c1># kubectl karmada register 10.0.0.58:32443 --token jcbljd.tfotd1ylodf7jtm6 --discovery-token-ca-cert-hash sha256:3bc5b22efbef8470f010f65b68388266e2b8f3ab62a0151900761cd12760d34f</span>
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Running pre-flight checks
</span></span><span class=line><span class=cl><span class=o>[</span>prefligt<span class=o>]</span> All pre-flight checks were passed
</span></span><span class=line><span class=cl><span class=o>[</span>karmada-agent-start<span class=o>]</span> Waiting to perform the TLS Bootstrap
</span></span><span class=line><span class=cl><span class=o>[</span>karmada-agent-start<span class=o>]</span> Waiting to construct karmada-agent kubeconfig
</span></span><span class=line><span class=cl><span class=o>[</span>karmada-agent-start<span class=o>]</span> Waiting the necessary secret and RBAC
</span></span><span class=line><span class=cl><span class=o>[</span>karmada-agent-start<span class=o>]</span> Waiting karmada-agent Deployment
</span></span><span class=line><span class=cl>W0303 13:35:48.478036   <span class=m>21025</span> check.go:52<span class=o>]</span> Pod: karmada-agent-5477cc77f7-qhfk4 not ready. status: ContainerCreating
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>I0303 13:36:34.484207   <span class=m>21025</span> check.go:49<span class=o>]</span> pod: karmada-agent-5477cc77f7-qhfk4 is ready. status: Running
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cluster<span class=o>(</span>cluster1<span class=o>)</span> is joined successfully
</span></span></code></pre></div><p>回到 karmada 查看，集群已经注册上了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@lixd-tmp-1 ~<span class=o>]</span><span class=c1># kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get clusters</span>
</span></span><span class=line><span class=cl>NAME       VERSION   MODE   READY   AGE
</span></span><span class=line><span class=cl>cluster1   v1.23.6   Pull   True    72s
</span></span><span class=line><span class=cl>cluster2   v1.23.6   Push   True    3m
</span></span></code></pre></div><h3 id=小结>小结</h3><ul><li>Push 模式是由 karmada 主动向 member 集群 apiserver 推送数据</li><li>Pull 模式则是在 member 集群部署了 karmada-agent，由该 agent 主动向 karmada 拉取数据。</li></ul><p>对比：</p><ul><li>网络方面：Push 模式需要 karmada 能访问所有 member 集群 apiserver，Pull 模式需要 member 集群能访问 karmada apiserver 即可。<ul><li>之前的 push 模式注册的集群显示没有 Ready 就是因为无法访问导致的。</li></ul></li><li>效率方面：当规模较大时 Push 模式由于需要想所有 member 集群推送数据，可能效率会比较低。</li></ul><h2 id=4-应用分发>4. 应用分发</h2><p>前面已经分别使用 push 和 pull 模式添加了两个集群到 karmada 了，接下来就简单体验一下 karmada 是如何管理多集群应用的。</p><p>在这之前简单给大家讲解一下 Karmada 的运行逻辑：</p><p>我们只需要把平时 apply 到 kube-apiserver 的 资源对象 全部 apply 到 karmada-apiserver，然后搭配上 karmada 中的 CRD 对象 PropagationPolicy 即可完成多集群应用管理，Karmada 就会根据 PropagationPolicy 中指定的规则，将这些资源对象分发到各个集群里。</p><blockquote><p>比如使用 PropagationPolicy 指定将某个 deploy 分发到 cluster1 和 cluster2</p></blockquote><p>同时 Karmada 还提供了 OverridePolicy CR 对象，用于在不同集群间实现差异化分发。</p><blockquote><p>比如 cluster1 为测试集群，那么可以通过 OverridePolicy 指定将分发到 cluster1 的资源对象中的 image 字段进行修改，添加 test 标记。</p></blockquote><h3 id=创建-propagationpolicy>创建 PropagationPolicy</h3><p>部署之前需要先定义 PropagationPolicy 以告知 karmada 需要把对应对应的资源部署到哪些集群里。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=c># propagationpolicy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>policy.karmada.io/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PropagationPolicy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-policy</span><span class=w> </span><span class=c># The default namespace is `default`.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourceSelectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w> </span><span class=c># If no namespace is specified, the namespace is inherited from the parent object scope.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>placement</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>clusterAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>clusterNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>cluster2</span><span class=w>
</span></span></span></code></pre></div><p>这个 PropagationPolicy 表示把 default namespace 下的名叫 nginx 的 deployment 部署到 cluster1 和 cluster2。</p><p>将该 PropagationPolicy apply 到 karmada:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1># kubectl apply -f propagationpolicy.yaml</span>
</span></span><span class=line><span class=cl>kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f propagationpolicy.yaml
</span></span></code></pre></div><h3 id=创建-deploy>创建 deploy</h3><p>在 defualt namespace 下创建一个名为 name 的 deploy 进行测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1>#kubectl create deployment nginx --image nginx</span>
</span></span><span class=line><span class=cl>kubectl --kubeconfig /etc/karmada/karmada-apiserver.config create deployment nginx --image nginx
</span></span></code></pre></div><p>Karmada 就会根据 propagationpolicy 把我们刚创建的 deploy 分发到 cluster1 和 cluster2 上面。</p><p>查看 karmada 里的 deploy 状态</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@karmada ~<span class=o>]</span><span class=c1># kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get deploy</span>
</span></span><span class=line><span class=cl>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx   0/1     <span class=m>2</span>            <span class=m>0</span>           35s
</span></span></code></pre></div><p>去各个集群查看</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@cluster1 ~<span class=o>]</span><span class=c1># kubectl get deploy</span>
</span></span><span class=line><span class=cl>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx   0/1     <span class=m>1</span>            <span class=m>0</span>           43s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@cluster2 ~<span class=o>]</span><span class=c1># kubectl get deploy</span>
</span></span><span class=line><span class=cl>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx   0/1     <span class=m>1</span>            <span class=m>0</span>           48s
</span></span></code></pre></div><p>等启动完成后再次查看 karmada 中的 deploy 状态</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@karmada ~<span class=o>]</span><span class=c1># kubectl --kubeconfig /etc/karmada/karmada-apiserver.config get deploy</span>
</span></span><span class=line><span class=cl>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx   2/1     <span class=m>2</span>            <span class=m>2</span>           3m
</span></span></code></pre></div><blockquote><p>cluster1 和 cluster2 都启动了一个，所以 karmada 这里显示的是 ready 2/1</p></blockquote><h3 id=创建-overridepolicy>创建 OverridePolicy</h3><p>创建一个 OverridePolicy,把 cluster1 的镜像 tag 替换为 1.20</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>policy.karmada.io/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>OverridePolicy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourceSelectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>overrideRules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>targetCluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>clusterNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>overriders</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imageOverrider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>Tag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>replace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;1.20&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>kubectl --kubeconfig /etc/karmada/karmada-apiserver.config apply -f op.yaml</span><span class=w>
</span></span></span></code></pre></div><p>然后去 cluster 查看,已经替换成功：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=o>[</span>root@cluster-2 ~<span class=o>]</span><span class=c1># kubecyl get deploy -oyaml|grep image</span>
</span></span><span class=line><span class=cl>        - image: nginx:1.20
</span></span><span class=line><span class=cl>          imagePullPolicy: Always
</span></span></code></pre></div><h2 id=5-小结>5. 小结</h2><p>本文主要记录了如何部署 Karmada 以及 Karmada 的基本使用，包括集群管理和应用分发功能。</p><ul><li><p>部署：karmada 提供了 kubectl 插件 可以一键部署</p></li><li><p>集群管理：有 pull 和 push 两种模式可选</p></li><li><p>应用分发：需要创建 PropagationPolicy 以及 OverridePolicy 对象告知 karmada 如何进行应用分发</p></li></ul><p>简单来说就是以前往 kube-apiserver 发请求创建 deploy、service 等对象，使用 karmada 之后就往 karmada-apiserver 创建这些对象，然后通过分发策略告知 karmada 需要将这些资源分发到哪些集群里，然后 karmada 就会往对应集群里写入这些资源对象了。</p><blockquote><p>关于 Karmada 原理可以期待后续文章~</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-04-08</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/ data-title="K8s 多集群(一)---Karmada 初体验" data-hashtags=Karmada><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/ data-hashtag=Karmada><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/ data-title="K8s 多集群(一)---Karmada 初体验"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/ data-title="K8s 多集群(一)---Karmada 初体验"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://www.lixueduan.com/posts/karmada/01-karmada-deploy/ data-title="K8s 多集群(一)---Karmada 初体验"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/karmada/>Karmada</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/docker/11-use-ssh-private-key-in-docker-build/ class=prev rel=prev title="Docker教程(十一)---如何在 Docker Build 时使用 SSH 私钥进行认证"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Docker教程(十一)---如何在 Docker Build 时使用 SSH 私钥进行认证</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/lixd target=_blank>意琦行</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a rel="license external nofollow noopener noreffer" href=https://beian.miit.gov.cn/ target=_blank>渝ICP备20005680号-1</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.480e58b2c2a8605d406f34667e92ff8f1ae50cfee5b653bead570f004839a983.js integrity="sha256-SA5YssKoYF1AbzRmfpL/jxrlDP7ltlO+rVcPAEg5qYM="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-FL23FNP7CM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-FL23FNP7CM" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4b7c98449a6edf8492a8f3404e6d06a0",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7693630257897132" crossorigin=anonymous></script></body></html>